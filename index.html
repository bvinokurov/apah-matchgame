<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AP Art History ‚Äî Match Game</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#111827; --muted:#6b7280; --border:#e5e7eb;
      --chip:#f3f4f6; --good:#16a34a; --bad:#dc2626; --shadow: 0 1px 10px rgba(17,24,39,.06);
    }
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--fg);}
    header{position:sticky;top:0;background:rgba(255,255,255,.92);backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--border);z-index:10;}
    .wrap{max-width:1100px;margin:0 auto;padding:16px;}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
    .brand{font-weight:800;letter-spacing:.2px;}
    button{border:1px solid var(--border);background:#fff;border-radius:12px;padding:10px 12px;cursor:pointer;}
    button.primary{background:#111827;color:#fff;border-color:#111827;}
    button:disabled{opacity:.6;cursor:not-allowed;}
    .pill{font-size:12px;background:var(--chip);border:1px solid var(--border);padding:6px 10px;border-radius:999px;color:#374151;}
    main{padding:18px 0 44px;}
    .hero{border:1px solid var(--border);border-radius:18px;padding:16px;box-shadow:var(--shadow);background:linear-gradient(180deg,#fff,#fafafa);}
    .hero h1{margin:0;font-size:22px;}
    .hero p{margin:8px 0 0;color:var(--muted);line-height:1.35}
    .layout{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px;}
    @media (max-width:900px){.layout{grid-template-columns:1fr;}}
    .panel{border:1px solid var(--border);border-radius:18px;background:#fff;box-shadow:var(--shadow);overflow:hidden;}
    .panel h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--border);font-size:14px;color:#374151;background:#fcfcfc;}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:14px;}
    @media (max-width:520px){.grid{grid-template-columns:1fr;}}
    .imgcard{border:1px solid var(--border);border-radius:16px;overflow:hidden;background:#fff;cursor:pointer;transition:transform .06s ease;}
    .imgcard:active{transform:scale(.99);}
    .thumb{aspect-ratio:4/3;background:var(--chip);display:flex;align-items:center;justify-content:center;overflow:hidden;}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block;}
    .cap{padding:10px 10px 12px;}
    .cap .small{color:var(--muted);font-size:12px;line-height:1.25}
    .selected{outline:3px solid #111827;outline-offset:-3px;}
    .matched{border-color:rgba(22,163,74,.35);box-shadow:0 0 0 3px rgba(22,163,74,.14) inset;}
    .titles{display:flex;flex-direction:column;gap:10px;padding:14px;}
    .tbtn{width:100%;text-align:left;border:1px solid var(--border);border-radius:14px;padding:10px 12px;background:#fff;cursor:pointer;}
    .tbtn .t{font-weight:650;}
    .tbtn .m{color:var(--muted);font-size:12px;margin-top:4px;}
    .tbtn.matched{border-color:rgba(22,163,74,.35);background:#f0fdf4;}
    .tbtn.wrong{border-color:rgba(220,38,38,.35);background:#fef2f2;}
    .status{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;align-items:center;}
    .msg{font-size:13px;color:#374151;}
    .msg.good{color:var(--good);}
    .msg.bad{color:var(--bad);}
    .footer{color:var(--muted);font-size:12px;margin-top:10px;line-height:1.35}
    .kbd{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;background:var(--chip);border:1px solid var(--border);padding:2px 6px;border-radius:8px;font-size:12px;}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row">
      <div class="brand">AP Art History ‚Äî Match Game</div>
      <span class="pill" id="roundInfo">Round: ‚Äî</span>
      <span class="pill" id="scoreInfo">Score: 0</span>
      <span class="pill" id="streakInfo">Streak: 0</span>
      <button class="primary" id="newRoundBtn">New Round</button>
      <button id="revealBtn">Reveal Answers</button>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="hero">
    <h1>Match the image to the correct title</h1>
    <p>
      Click an image on the left, then click a title on the right.
      Thumbnails load automatically (Wikipedia).
      Best on desktop, works on phones too.
    </p>
    <div class="status">
      <div class="msg" id="msg">Loading‚Ä¶</div>
      <div class="pill">Tip: press <span class="kbd">New Round</span> to shuffle.</div>
    </div>
    <div class="footer">
      If a thumbnail fails, Wikipedia didn‚Äôt return an image for that entry‚Äîswap the <span class="kbd">wiki</span> title in the dataset.
    </div>
  </div>

  <div class="layout">
    <section class="panel">
      <h2>Images</h2>
      <div class="grid" id="imageGrid"></div>
    </section>

    <section class="panel">
      <h2>Titles</h2>
      <div class="titles" id="titleList"></div>
    </section>
  </div>
</main>

<script>
/**
 * DATASET
 * Each item needs a Wikipedia page title ("wiki") so we can auto-fetch a thumbnail.
 * You can add your full 250 later by copying this format.
 */
const WORKS = [
  // Unit 2 anchors
  { unit: 2, title: "Palette of Narmer", wiki: "Narmer Palette", meta:"Predynastic Egypt ‚Ä¢ c. 3000 BCE" },
  { unit: 2, title: "Seated Scribe", wiki: "Seated Scribe", meta:"Old Kingdom Egypt ‚Ä¢ c. 2500 BCE" },
  { unit: 2, title: "Parthenon", wiki: "Parthenon", meta:"Classical Greece ‚Ä¢ 447‚Äì432 BCE" },
  { unit: 2, title: "Pantheon", wiki: "Pantheon, Rome", meta:"Rome ‚Ä¢ 118‚Äì125 CE" },

  // Unit 4 anchors
  { unit: 4, title: "Mona Lisa", wiki: "Mona Lisa", meta:"Leonardo ‚Ä¢ c. 1503‚Äì1506" },
  { unit: 4, title: "David", wiki: "David (Michelangelo)", meta:"Michelangelo ‚Ä¢ 1501‚Äì1504" },
  { unit: 4, title: "Las Meninas", wiki: "Las Meninas", meta:"Vel√°zquez ‚Ä¢ 1656" },
  { unit: 4, title: "Girl with a Pearl Earring", wiki: "Girl with a Pearl Earring", meta:"Vermeer ‚Ä¢ c. 1665" },

  // Global anchors
  { unit: 8, title: "Great Wave off Kanagawa", wiki: "The Great Wave off Kanagawa", meta:"Hokusai ‚Ä¢ 1830‚Äì1833" },
  { unit: 8, title: "Terracotta Army", wiki: "Terracotta Army", meta:"Qin China ‚Ä¢ c. 210 BCE" },
  { unit: 5, title: "Machu Picchu", wiki: "Machu Picchu", meta:"Inca ‚Ä¢ c. 1450" },
  { unit: 7, title: "Taj Mahal", wiki: "Taj Mahal", meta:"Mughal India ‚Ä¢ 1632‚Äì1653" },
];

/** Game settings */
const ROUND_SIZE = 6; // choose 6 each round (good on phones)
const WIKI_SUMMARY = "https://en.wikipedia.org/api/rest_v1/page/summary/";

/** App state */
let round = 0;
let score = 0;
let streak = 0;
let revealMode = false;

let currentSet = [];
let selectedImageId = null; // index in currentSet
let matched = new Set(); // matched indices

const elImageGrid = document.getElementById("imageGrid");
const elTitleList  = document.getElementById("titleList");
const elMsg        = document.getElementById("msg");
const elRoundInfo  = document.getElementById("roundInfo");
const elScoreInfo  = document.getElementById("scoreInfo");
const elStreakInfo = document.getElementById("streakInfo");
const btnNewRound  = document.getElementById("newRoundBtn");
const btnReveal    = document.getElementById("revealBtn");

function setMsg(text, kind="") {
  elMsg.className = "msg " + (kind || "");
  elMsg.textContent = text;
}
function setHUD() {
  elRoundInfo.textContent = `Round: ${round}`;
  elScoreInfo.textContent = `Score: ${score}`;
  elStreakInfo.textContent = `Streak: ${streak}`;
}

function shuffle(arr) {
  const a = arr.slice();
  for (let i=a.length-1;i>0;i--) {
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

function pickRoundWorks() {
  const pool = shuffle(WORKS);
  return pool.slice(0, Math.min(ROUND_SIZE, pool.length));
}

async function fetchThumb(wikiTitle) {
  const url = WIKI_SUMMARY + encodeURIComponent(wikiTitle);
  const r = await fetch(url, { headers: { "accept": "application/json" } });
  if (!r.ok) throw new Error("Wikipedia fetch failed");
  const data = await r.json();
  const thumb = data?.thumbnail?.source || "";
  const extract = data?.extract || "";
  return { thumb, extract, page: data?.content_urls?.desktop?.page || "" };
}

function clearSelections() {
  selectedImageId = null;
  document.querySelectorAll(".imgcard").forEach(c => c.classList.remove("selected"));
  document.querySelectorAll(".tbtn").forEach(b => b.classList.remove("selected"));
}

function allMatched() {
  return matched.size === currentSet.length;
}

function render() {
  elImageGrid.innerHTML = "";
  elTitleList.innerHTML = "";
  matched = new Set();
  selectedImageId = null;

  // Build images (left)
  currentSet.forEach((w, idx) => {
    const card = document.createElement("div");
    card.className = "imgcard";
    card.dataset.idx = String(idx);

    const thumb = document.createElement("div");
    thumb.className = "thumb";
    thumb.innerHTML = w._thumb
      ? `<img alt="${escapeHtml(w.title)}" src="${w._thumb}">`
      : `<div class="cap"><div class="small">No thumbnail</div></div>`;

    const cap = document.createElement("div");
    cap.className = "cap";
    cap.innerHTML = `<div class="small">${escapeHtml(w.meta || "")}</div>`;

    card.appendChild(thumb);
    card.appendChild(cap);

    card.addEventListener("click", () => onSelectImage(idx));
    elImageGrid.appendChild(card);
  });

  // Build titles (right) ‚Äî shuffled order
  const shuffledTitles = shuffle(currentSet.map((w, idx) => ({ idx, title: w.title, meta: w.meta })));

  shuffledTitles.forEach(item => {
    const btn = document.createElement("button");
    btn.className = "tbtn";
    btn.dataset.idx = String(item.idx);
    btn.innerHTML = `<div class="t">${escapeHtml(item.title)}</div><div class="m">${escapeHtml(item.meta || "")}</div>`;
    btn.addEventListener("click", () => onPickTitle(item.idx, btn));
    elTitleList.appendChild(btn);
  });

  setMsg("Pick an image, then pick a title.", "");
}

function onSelectImage(idx) {
  if (revealMode) return;
  if (matched.has(idx)) return;

  selectedImageId = idx;
  document.querySelectorAll(".imgcard").forEach(c => c.classList.remove("selected"));
  const selected = document.querySelector(`.imgcard[data-idx="${idx}"]`);
  selected?.classList.add("selected");
  setMsg("Now choose the matching title on the right.", "");
}

function onPickTitle(titleIdx, btnEl) {
  if (revealMode) return;
  if (selectedImageId === null) {
    setMsg("Pick an image first (left).", "bad");
    return;
  }
  if (matched.has(titleIdx)) return;

  const correct = (titleIdx === selectedImageId);
  const imgCard = document.querySelector(`.imgcard[data-idx="${selectedImageId}"]`);
  const titleBtn = document.querySelector(`.tbtn[data-idx="${titleIdx}"]`);

  if (correct) {
    matched.add(titleIdx);
    score += 10;
    streak += 1;
    imgCard?.classList.add("matched");
    titleBtn?.classList.add("matched");
    setMsg("Correct ‚úÖ", "good");
  } else {
    score = Math.max(0, score - 3);
    streak = 0;
    titleBtn?.classList.add("wrong");
    setMsg("Not quite ‚Äî try again.", "bad");
    // remove wrong highlight quickly
    setTimeout(() => titleBtn?.classList.remove("wrong"), 550);
  }

  setHUD();
  clearSelections();

  if (allMatched()) {
    score += 15;
    setHUD();
    setMsg("Round complete üéâ Click ‚ÄúNew Round‚Äù.", "good");
  }
}

function escapeHtml(s) {
  return String(s).replace(/[&<>"']/g, c => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
  }[c]));
}

async function startRound() {
  revealMode = false;
  btnReveal.textContent = "Reveal Answers";
  round += 1;
  setHUD();
  setMsg("Loading thumbnails‚Ä¶", "");

  currentSet = pickRoundWorks().map(w => ({ ...w, _thumb:"", _extract:"", _page:"" }));

  // Load thumbnails in parallel
  await Promise.all(currentSet.map(async (w, i) => {
    try {
      const res = await fetchThumb(w.wiki);
      currentSet[i]._thumb = res.thumb;
      currentSet[i]._extract = res.extract;
      currentSet[i]._page = res.page;
    } catch (e) {
      // leave thumbnail blank
    }
  }));

  render();
}

function toggleReveal() {
  revealMode = !revealMode;

  if (revealMode) {
    // Show matches by marking all correct
    currentSet.forEach((_, idx) => {
      document.querySelector(`.imgcard[data-idx="${idx}"]`)?.classList.add("matched");
      document.querySelector(`.tbtn[data-idx="${idx}"]`)?.classList.add("matched");
    });
    btnReveal.textContent = "Hide Answers";
    setMsg("Answers revealed. Click ‚ÄúHide Answers‚Äù to keep playing.", "");
  } else {
    // Reset visual states but keep round
    btnReveal.textContent = "Reveal Answers";
    document.querySelectorAll(".imgcard").forEach(c => c.classList.remove("matched","selected"));
    document.querySelectorAll(".tbtn").forEach(b => b.classList.remove("matched","selected","wrong"));
    matched = new Set();
    selectedImageId = null;
    setMsg("Back to play mode. Match image ‚Üí title.", "");
  }
}

btnNewRound.addEventListener("click", startRound);
btnReveal.addEventListener("click", toggleReveal);

// Start
setHUD();
startRound();
</script>
</body>
</html>
